machine:
  services:
    - docker

dependencies:
  override:
    - docker build --rm=false -t docker/compliance-opencontrol .
    - cp -r DTR nlp/ && cp -r DockerEE nlp/ && cp -r UCP nlp/ && cp -r DSS nlp/ && cp -r eNZi nlp/
    - docker build --rm=false -t docker/compliance-opencontrol-nlp nlp/
    - rm -rf nlp/DTR && rm -rf nlp/DockerEE && rm -rf nlp/UCP && rm -rf nlp/DSS && rm -rf nlp/eNZi

test:
  override:
    - docker run docker/compliance-opencontrol
    - docker run -v "$(pwd)":/root -e "TEXT_ANALYTICS_API_KEY=$TEXT_ANALYTICS_API_KEY" docker/compliance-opencontrol-nlp /bin/bash -c "./go.test.sh; cp coverage.txt /root"
    - docker run -e "TEXT_ANALYTICS_API_KEY=$TEXT_ANALYTICS_API_KEY" docker/compliance-opencontrol-nlp
  post:
    - bash <(curl -s https://codecov.io/bash)