machine:
  services:
    - docker

dependencies:
  override:
    - docker build --rm=false -t docker/compliance-opencontrol .
    - docker build --rm=false -t docker/compliance-nlputil nlptooling/nlputil

test:
  override:
    - docker run docker/compliance-opencontrol
    - cd nlptooling/nlputil
    - docker run -v "$(pwd)":/go/src/github.com/docker/compliance/nlptooling/nlputil -e TEXT_ANALYTICS_API_KEY --entrypoint '' docker/compliance-nlputil bash -c "./go.test.sh"
    - $(pwd)
    - cp coverage.txt ../../
    - cd ../../examples/DockerEE-compliance
    - make opencontrols
    - docker run -v "$(pwd)":/DockerEE-compliance -w /DockerEE-compliance -e TEXT_ANALYTICS_API_KEY docker/compliance-nlputil analyze keyphrases
  post:
    - bash <(curl -s https://codecov.io/bash)